define("chess-grid",["backbone"],function(){var e=Backbone.View.extend({elms:{item:".chess-grid-item",image:".chess-grid-image"},options:{},matrix:[],matrixRowLimit:0,initialize:function(){var e=this;e.parseOptions(),e.options.columns||(e.options.columns=2),e.options.margin||(e.options.margin=0),e.renderGrid(),1=="onorientationchange"in window?$(window).on("orientationchange.chess-grid",function(){e.resizeGrid()}).trigger("orientationchange.chess-grid"):$(window).on("resize.chess-grid",function(){e.resizeGrid()}).trigger("resize.chess-grid")},parseOptions:function(){var e=this,t=this.$el.data()||{};return $.each(t,function(n,r){t.hasOwnProperty(n)&&(e.options[n]=r)}),this},renderGrid:function(){var e=this,t=Math.round((e.$el.width()-(e.options.columns*2-1)*e.options.margin)/e.options.columns/2);e.addRowToMartix(),e.$el.find(e.elms.item).each(function(){var t=sh=0,n=$(this).data("type"),r=$(this).index()+1,i={};$(this).attr("id",r);switch(n){case"2x1":t=2,sh=1;break;case"2x2":t=sh=2;break;case"nx2":t=e.options.columns*2,sh=2}i=e.findPlaceInMatrix(t,sh,r),$(this).data({top:i.top,left:i.left}),n=="nx2"&&(e.matrixRowLimit=i.top+2)});if(e.options.textPosition=="auto"){var n=!0,r=0;e.$el.find(e.elms.item).each(function(){if($(this).is(".text-hover")==0){$(this).removeClass("text-left text-right");var e=$(this).data("top");e!=r&&(n=!n,r=e),n==1?$(this).addClass("text-left"):$(this).addClass("text-right")}})}},addRowToMartix:function(){this.matrix.push([]);var e=this.matrix.length-1;for(i=0;i<this.options.columns*2;i++)this.matrix[e][i]=0},findPlaceInMatrix:function(e,t,n){var r=!1,i={top:0,left:0};for(j=this.matrixRowLimit;j<this.matrix.length;j++){var s=_.indexOf(this.matrix[j],0);if(s!=-1&&s+e<=this.options.columns*2&&_.max(this.matrix[j].slice(s,s+e))==0){for(k=0;k<e;k++)for(l=0;l<t;l++)this.matrix[j+l]||this.addRowToMartix(),this.matrix[j+l][s+k]=n,i={top:j,left:s};r=!0;break}}if(r==0){s=0,j=this.matrix.length;for(k=0;k<e;k++)for(l=0;l<t;l++)this.matrix[j+l]||this.addRowToMartix(),this.matrix[j+l][s+k]=n,i={top:j,left:s}}return i},resizeGrid:function(){var e=this,t=Math.round((e.$el.width()-(e.options.columns*2-1)*e.options.margin)/e.options.columns/2);e.$el.find(e.elms.item).each(function(){var n=$(this).data("type"),r=$(this).data("rate")||1,i=h=0;switch(n){case"2x1":i=t*2+e.options.margin,h=t;break;case"2x2":i=h=t*2+e.options.margin;break;case"nx2":i="100%",h=t*2+e.options.margin}$(this).width(i).height(h).css({top:$(this).data("top")*(t+e.options.margin),left:$(this).data("left")*(t+e.options.margin)});if($(this).is(".text-left")){var i="50%";r!=2&&(i=t),$(this).find(".chess-grid-text").width(i),$(this).find(".chess-grid-image").css("marginLeft",i)}if($(this).is(".text-right")){var i="50%";r!=2&&(i=(t*2+e.options.margin-t)*r),$(this).find(".chess-grid-text").width(i),$(this).find(".chess-grid-image").css("marginRight",i)}})},render:function(){return this}});return e});